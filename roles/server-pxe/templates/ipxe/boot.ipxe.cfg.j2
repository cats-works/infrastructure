#!ipxe

# This configuration is managed by Ansible
# Last Update: {{ ansible_date_time.iso8601 }}
# Do not make any manual edits they will be lost.

iseq ${buildarch} x86_64 && set archefi X64 ||
iseq ${buildarch} x86_64 && set archl amd64 || 
iseq ${buildarch} x86_64 && set archrh x86_64 || 
iseq ${buildarch} x86_64 && set archdisp AMD64 || 
iseq ${buildarch} x86_64 && set winver 8.1-11 || 
iseq ${buildarch} x86_64 && set pconly true || 
iseq ${buildarch} x86_64 && set is64 true ||
iseq ${buildarch} arm64 && set archefi AA64 || 
iseq ${buildarch} arm64 && set archl arm64 || 
iseq ${buildarch} arm64 && set archrh aarch64 || 
iseq ${buildarch} arm64 && set archdisp ARM64 || 
iseq ${buildarch} arm64 && set winver 10-11 || 
iseq ${buildarch} arm64 && set is64 true ||
iseq ${buildarch} i386 && set archefi X86 || 
iseq ${buildarch} i386 && set archl i686 || 
iseq ${buildarch} i386 && set archrh i686 || 
iseq ${buildarch} i386 && set archdisp IA32 || 
iseq ${buildarch} i386 && set winver 7-10 || 
iseq ${buildarch} i386 && set pconly true || 
iseq ${buildarch} i386 && set is64 false ||

iseq ${platform} pcbios && cpuid --ext 29 && set archefi X64 ||
iseq ${platform} pcbios && cpuid --ext 29 && set archl amd64 ||
iseq ${platform} pcbios && cpuid --ext 29 && set archrh x86_64 ||
iseq ${platform} pcbios && cpuid --ext 29 && set archefi X64 ||
iseq ${platform} pcbios && cpuid --ext 29 && set archdisp AMD64 ||
iseq ${platform} pcbios && cpuid --ext 29 && set is64 true ||

set prefix 32

iseq ${netmask} 0.0.0.0 && set prefix 0 ||
iseq ${netmask} 128.0.0.0 && set prefix 1 ||
iseq ${netmask} 192.0.0.0 && set prefix 2 ||
iseq ${netmask} 224.0.0.0 && set prefix 3 ||
iseq ${netmask} 240.0.0.0 && set prefix 4 ||
iseq ${netmask} 248.0.0.0 && set prefix 5 ||
iseq ${netmask} 252.0.0.0 && set prefix 6 ||
iseq ${netmask} 254.0.0.0 && set prefix 7 ||
iseq ${netmask} 255.0.0.0 && set prefix 8 ||

iseq ${netmask} 255.128.0.0 && set prefix 9 ||
iseq ${netmask} 255.192.0.0 && set prefix 10 ||
iseq ${netmask} 255.224.0.0 && set prefix 11 ||
iseq ${netmask} 255.240.0.0 && set prefix 12 ||
iseq ${netmask} 255.248.0.0 && set prefix 13 ||
iseq ${netmask} 255.252.0.0 && set prefix 14 ||
iseq ${netmask} 255.254.0.0 && set prefix 15 ||
iseq ${netmask} 255.255.0.0 && set prefix 16 ||

iseq ${netmask} 255.255.128.0 && set prefix 17 ||
iseq ${netmask} 255.255.192.0 && set prefix 18 ||
iseq ${netmask} 255.255.224.0 && set prefix 19 ||
iseq ${netmask} 255.255.240.0 && set prefix 20 ||
iseq ${netmask} 255.255.248.0 && set prefix 21 ||
iseq ${netmask} 255.255.252.0 && set prefix 22 ||
iseq ${netmask} 255.255.254.0 && set prefix 23 ||
iseq ${netmask} 255.255.255.0 && set prefix 24 ||

iseq ${netmask} 255.255.255.128 && set prefix 25 ||
iseq ${netmask} 255.255.255.192 && set prefix 26 ||
iseq ${netmask} 255.255.255.224 && set prefix 27 ||
iseq ${netmask} 255.255.255.240 && set prefix 28 ||
iseq ${netmask} 255.255.255.248 && set prefix 29 ||
iseq ${netmask} 255.255.255.252 && set prefix 30 ||
iseq ${netmask} 255.255.255.254 && set prefix 31 ||
iseq ${netmask} 255.255.255.255 && set prefix 32 ||

set nfs-server {{ vault_lgb_nas_ip }}
set pxe-server {{ pxe_server_hostname }}
set nfs-root /nas/osboot/
set boot-url http://${pxe-server}/
set sanboot-url http:/${pxe-server}/
set boot-dir tftp/boot/
set mac-config-dir tftp/bymac/
set menu-url http://${pxe-server}/tftp/menu.ipxe
set win-base-url http://{{ pxe_server_hostname }}/winpeboot
set dart-base-url http://{{ pxe_server_hostname }}/dartboot